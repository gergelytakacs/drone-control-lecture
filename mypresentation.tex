\documentclass{beamer}
\input{UAMAIbeamer}
\usepackage{xspace} % Backspace. Prevents certain commands to eating spaces.
\newcommand{\Ohm}{$\Omega$\xspace} % Ohms
\newcommand{\E}[1]{$\mathrm{E}{#1}$} % Engineering notation

%\dualscreen

\newcommand{\angl}[1]{{\color{gray}(\emph{angl.:} #1)}}


\title[Riadiace Algoritmy Dronov]
{Working title drone control}
\subtitle{\vspace{1em}Riadenie dronov}
\author[]{prof. Ing. Gergely Takács, PhD.}
\date[07.12.2021]{}
\slideheader{SK}
\slidefooter{SK}{STU}
\bibliographyfile{gergelytakacsBibliography.bib}{SK}


\begin{document}
\titleslide[]{SK}{STU}


%viem si predstavit klasika kaskadne riadenie ala arducopter
%%potom mozno LQR a Integral backstepping a vysvetlit co ma aku vyhodu ...

%\input{_opakovanie.tex}

\begin{frame}{Riadená sústava}
\begin{figure}
\centering
  \includegraphics[width=\textwidth]{rollpitch}\\
\end{figure}
\end{frame}


\begin{frame}[t]{Rýchlosť zmeny orientácie}
\begin{itemize}
  \item<1-> Tvárme sa, že poznáme žiadanú uhlovú rýchlosť orientácie $r_{\dot{\Theta}}$, $r_{\dot{\Phi}}$ a $r_{\dot{\Psi}}$ a pre jednoduchosť sústredme len na rýchlosť zmeny klopenia ($\dot{\Theta}$).
  \item<2-> Sme na najnižšej úrovni riadenia --- je to zároveň aj najdôležitejšia slučka \citep{AP:PID}
  \end{itemize}

  \begin{onlyenv}<1>
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{ATT_Rate}\\
\end{figure}
\end{onlyenv}

  \begin{onlyenv}<2>
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{ATT_Rate2}\\
\end{figure}
\end{onlyenv}

  \end{frame}

\begin{frame}[t]{Ohraničenie vstupov}
  \begin{itemize}
    \item<1-> Akčné zásahy majú svoje ohraničenia (\angl{constraints})
    \item<2-> Ako donútime ich dodržanie? Saturáciou (orezávaním) hodnôt, ktoré skutočne vypočíta PID.
    \item<3-> Saturácia vnáša nelinearitu, vplýva na výkon riadenia aj stabilitu.
    \item<4-> Aj iné veličiny môžeme saturovať, napr. žiadané hodnoty. Ako by sme ohraničili výstup?
  \end{itemize}

    \begin{onlyenv}<2->
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{ATT_Rate3}\\
\end{figure}
\end{onlyenv}
\end{frame}


\begin{frame}[t]{Nahromadenie integračnej zložky}
  \begin{itemize}
    \item<1-> Integračná zložka ráta odchýlku v minulosti, preto ak akčné členy sú už na hraniciach možností - začína sa to zbytočne hromadiť \angl{windup}.
    %alebo sa to zbtočne nahromadí/začína sa zbytočne nahromaďovať (nemôže sa yačínať robiť sloveso v dokonavom vide...)
    \item<2-> Akonáhle sa vrátia akčné zásahy pod ohraničenia, nahromadená I zložka stále bude tlačiť systém na hranice možností, musí sa to chvíľu ``uvoľňovať'' \angl{unwind} a tým pádom prestrelíme \angl{overshoot} žiadané hodnoty
    \item<3-> Tento nežiadaný efekt je saturácia integračnej zložky \angl{integral windup}.
    \item<4-> Môžeme používať rôzne triky, napr. ohraničiť veľkosť integračnej zložky, resp. vypnúť zložku pri určitých podmienkach.
  \end{itemize}
      \begin{onlyenv}<1->
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{ATT_Rate4}\\
\end{figure}
\end{onlyenv}

\end{frame}

\begin{frame}[t]{Nahromadenie integračnej zložky 2}
  \begin{itemize}
  \item<1-> ArduPilot - Ak akčný člen je akurát saturovaný, podrž hodnotu I zložky. Nižšie to môže ísť, vyššie nie \citep{AP:PID}.
  \item<2-> ArduPilot - Keďže máme kaskádnu konfiguráciu PID slučiek, saturačný znak postupuje cez hierarchiu nižšie a nižšie aby zastavil nahromadenie I zložky \citep{AP:PID}.
  \end{itemize}
\end{frame}

\begin{frame}[t]{Šum a derivačná zložka}
  \begin{itemize}
    \item<1-> aaaaaa
  \end{itemize}
      \begin{onlyenv}<1->
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{ATT_Rate5}\\
\end{figure}
\end{onlyenv}

\end{frame}




\begin{frame}[t]{Orientácia}
\begin{itemize}
  \item<1-> Riadiť orientáciu len na základe zmeny rýchlosti by bolo dosť neintuitívne, potrebujeme prepočítať $r_{\Theta} \rightarrow r_{\dot{\Theta}}$
  \item<2-> Tvárme sa, že poznáme žiadané orientácie, napr. klopenie $r_{\Theta}$.
  \item<3-> Riadenie orientácie môže byť riešené ďalšou, nadradenou regulačnou slučkou - hovoríme o tzv. kaskádnom riadení \angl{nested control}.
  \item<4-> Nadradené slučky sú pomalšie \citep{AP:PID}, vytvára to istý ``filter'', t.j. nemôžeme rýchlejšie ovládať rýchlosť ako polohu (cca. o rád, min polovicu pomalšie)
  \end{itemize}

  \begin{onlyenv}<3->
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{ATT_Angle}\\
\end{figure}
\end{onlyenv}

  \end{frame}



    \begin{frame}[t]{Orientácia 2}
\begin{itemize}
  \item<1-> Pri PID skôr PI\footnote{ArduCopter a PX4 Autopilot používa P regulátor \citep{PX4:PID,AP:PIDDOC}}, lebo
  \begin{itemize}
            \item iba P neodstráni, trvalú odchýlku
            \item D reaguje príliš agresívne na šum.
  \end{itemize}
      \item<2-> Do slučky dopracujeme doprednú väzbu \angl{feedforward} ktorá zrýchli odozvu regulácie
      \item<3-> ``Whatever works'' - netreba mystifikovať, je to len matematika\footnote{napr. }
  \end{itemize}


  \begin{onlyenv}<2->
\begin{figure}
\centering
  \includegraphics[width=\textwidth]{ATT_Angle2}\\
\end{figure}
\end{onlyenv}

  \end{frame}


<<<<<<< Updated upstream
\begin{frame}[t]{Nahromadenie integračnej zložky}
  \begin{itemize}
    \item<1-> Integračná zložka ráta odchýlku v minulosti, preto ak akčné členy sú už na hraniciach možností - začína sa to zbytočne hromadiť \angl{windup}.
    %alebo sa to zbtočne nahromadí/začína sa zbytočne nahromaďovať (nemôže sa yačínať robiť sloveso v dokonavom vide...)
    \item<2-> Akonáhle sa vrátia akčné zásahy pod ohraničenia, nahromadená I zložka stále bude tlačiť systém na hranice možností, musí sa to chvíľu ``uvoľňovať'' \angl{unwind} a tým pádom prestrelíme \angl{overshoot} žiadané hodnoty
    \item<3-> Tento nežiadaný efekt je saturácia integračnej zložky \angl{integral windup}.
    \item<4-> Môžeme používať rôzne triky, napr. ohraničiť veľkosť integračnej zložky, resp. vypnúť zložku pri určitých podmienkach.
  \end{itemize}
\end{frame}
=======
>>>>>>> Stashed changes





\begin{frame}[t]{Tvarovanie žiadaných hodnôt}
  \begin{itemize}
  \item<1-> Dron je stabilizovaný, pilot/ROS náhle chce $r_{\Phi}=$+30$^\circ$ klonenie. Čo sa stane s riadením?
  \item<2->  Žiadaná hodnota je skokový signál. Derivácia skoku je... D zložka a tým aj vstup do akčných členov vystrelí!
  \item<3->  Potrebujeme tvarovať vstupy do regulácie \angl{input shaping}, t.j. tvarovať žiadané hodnoty:
        \begin{itemize}
  \item Pomalšie vzorkovanie na rýchlejšie (interpolácia) \footnote{ArduCopter 50 Hz $\rightarrow$ 400 Hz \citep{AP:PID}}
  \item Vyhladenie filtráciou, saturácie
  \item<4-> Ak hovoríme o manuálnom pilotovaní, tvarovanie určuje aký ``pocit'' je riadiť stroj
  \end{itemize}
  \end{itemize}

        \begin{onlyenv}<2>
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{InputShaping_1}\\
\end{figure}
\end{onlyenv}


        \begin{onlyenv}<3->
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{InputShaping_2}\\
\end{figure}
\end{onlyenv}







\end{frame}

\begin{frame}[t]{Inicializácia riadenia}
\begin{itemize}
  \item<1-> Ako naštartujeme riadenie? Aká je odchýlka $e(0)$ pri štarte?
  \item<2-> Kritické pri zmene letových módov.
  \item<3-> Pre ArduCopter \cite{AP:PID}
    \begin{itemize}
    \item Nadradené riadenie poloha vs. rýchlosť (P) --- tak aby vstup bol konštantný
    \item Rýchlosť (PID) --- $e(0)=0$, I zložka s konštantným vstupom, zrátať D pri nastavení žiadanej hodnoty
\end{itemize}
\end{itemize}
\end{frame}


\begin{frame}[t]{Poloha}
\begin{itemize}
  \item<1-> Najnižšia úroveň je riadenie orientácie, tj. uhly $\Omega={\Phi, \Theta, \Sigma}$ a uhlové rýchlosti $\dot\Omega$ v ''body frame``
\end{itemize}

  \begin{onlyenv}<2->
\begin{figure}
\centering
  \includegraphics[width=\textwidth]{PID_HighLevel}\\
\end{figure}
\end{onlyenv}


\end{frame}




\begin{frame}{Je perfektné sledovanie trasy možné?}
\begin{itemize}
\item<1-> Majme trasu WP1 do WP2, všetko je v poriadku.
\item<2-> Pridajme WP3 a rozmýšľajme čo sa deje pri WP2. Je možné preletieť nad WP2?
\item<3-> Buď musíme úplne sa zastaviť alebo nemôžeme priamo preletieť --- ináč by sme potrebovali nekonečne veľké zrýchlenia
\end{itemize}

\begin{onlyenv}<1>
  \begin{figure}
\centering
  \includegraphics[width=60mm]{PositionControl}\\
\end{figure}
\end{onlyenv}

\begin{onlyenv}<2>
  \begin{figure}
\centering
  \includegraphics[width=60mm]{PositionControl2}\\
\end{figure}
\end{onlyenv}

\begin{onlyenv}<3>
  \begin{figure}
\centering
  \includegraphics[width=60mm]{PositionControl3}\\
\end{figure}
\end{onlyenv}


\end{frame}


\begin{frame}[t]{Automatické nastavenie parametrov}
\begin{itemize}
  \item ArduPilot (ArduCopter) --- Napodobňuje heuristiku \citep{AP:LogSeminar}
  \begin{itemize}
  \item Zvyšuje D parameter pomaly
  \item Akonáhle deteguje osciláciu, zníži D parameter
  \item Opakuje pre iné zložky/slučky
\end{itemize}
\item Intuitívne ale konzervatívne
\end{itemize}

\end{frame}



\begin{frame}
Notes: \cite{AP:PID}

User (ROS) $\rightarrow$ Shaping $\rightarrow$ PID $\rightarrow$ Actuators

50 Hz -> 400 Hz
Min 24 tazsie uchopytelne koncepty pre prezentaciu, dava menej konkretnosti

\end{frame}



\thankyouslide{gergely.takacs@stuba.sk}{SK}
\referencesslidebiber{SK}

%\backupbegin
%\input{...
%\backupend


\end{document}
