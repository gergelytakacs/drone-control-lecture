\documentclass{beamer}
\input{UAMAIbeamer}
\usepackage{xspace} % Backspace. Prevents certain commands to eating spaces.
\newcommand{\Ohm}{$\Omega$\xspace} % Ohms
\newcommand{\E}[1]{$\mathrm{E}{#1}$} % Engineering notation

%\dualscreen

\newcommand{\angl}[1]{{\color{gray}(\emph{angl.:} #1)}}


\title[Riadiace Algoritmy Dronov]
{Working title drone control}
\subtitle{\vspace{1em}Riadenie dronov}
\author[]{prof. Ing. Gergely Takács, PhD.}
\date[07.12.2021]{}
\slideheader{SK}
\slidefooter{SK}{STU}
\bibliographyfile{gergelytakacsBibliography.bib}{SK}


\begin{document}
\titleslide[]{SK}{STU}


%viem si predstavit klasika kaskadne riadenie ala arducopter
%%potom mozno LQR a Integral backstepping a vysvetlit co ma aku vyhodu ...

%\input{_opakovanie.tex}

\begin{frame}{Riadená sústava}
\begin{figure}
\centering
  \includegraphics[width=\textwidth]{rollpitch}\\
\end{figure}
\end{frame}


%\input{_01_PID_Rate.tex}
%\input{_02_PID_Attitude.tex}


\begin{frame}
DCM -> Direction Cosine Matrix (pre 3.2)
Transformation to inertial to body axes.
Quaternion 4 by 1
\end{frame}


\begin{frame}[t]{Poloha}
\begin{itemize}
  \item<1-> Najnižšia úroveň je riadenie orientácie, tj. uhly $\Omega={\Phi, \Theta, \Sigma}$ a uhlové rýchlosti $\dot\Omega$ v ''body frame``
\end{itemize}
\end{frame}


\begin{frame}[t]{Orientácia}
\begin{itemize}
  \item<1-> Riadiť orientáciu \angl{attitude} len na základe zmeny uhl. rýchlosti \angl{rate} by bolo dosť neintuitívne, potrebujeme prepočítať $r_{\Theta} \rightarrow r_{\dot{\Theta}}$
  \item<2-> Tvárme sa, že poznáme žiadané orientácie, napr. klopenie $r_{\Theta}$ a chceme riadiť $y_{\Theta}$.  V skutočnosti riešené s kvaterniónmy aby sme obišli singularitu Eulerových uhlov pri odhade \citep{Erasmus2020}.
  \item<3-> Riadenie orientácie môže byť riešené ďalšou, nadradenou regulačnou slučkou - hovoríme o tzv. kaskádnom riadení \angl{nested, cascaded}.
  \end{itemize}


    \begin{onlyenv}<1-2>
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{PID_HighLevel1a}\\
\end{figure}
\end{onlyenv}



    \begin{onlyenv}<3>
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{PID_HighLevel1b}\\
\end{figure}
\end{onlyenv}

  \end{frame}



\begin{frame}[t]{Orientácia 2}
\begin{itemize}
  \item<1-> Nadradené slučky sú pomalšie, vytvára to istý ``filter'', t.j. nemôžeme rýchlejšie ovládať rýchlosť ako polohu (cca. o rád, min polovicu pomalšie\footnote{ArduCopter 40 Hz vs 400 Hz, PX4 250 vs. 1000 Hz \citep{AP:PID,PX4:PID}}) \citep{AP:PID,PX4:PID}
  \item<2-> Pri PID skôr P\footnote{ArduCopter a PX4 Autopilot používa P regulátor \citep{PX4:PID,AP:PIDDOC}}, lebo reaguje príliš agresívne na šum.
  \item<3-> Do slučky dopracujeme doprednú väzbu \angl{feedforward} ktorá zrýchli odozvu regulácie. ``Whatever works'' - netreba mystifikovať.
  \end{itemize}



  \begin{onlyenv}<2>
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{ATT_Angle}\\
\end{figure}
\end{onlyenv}

  \begin{onlyenv}<3->
\begin{figure}
\centering
  \includegraphics[width=\textwidth]{ATT_Angle2}\\
\end{figure}
\end{onlyenv}

  \end{frame}



  \begin{frame}[t]{Orientácia 3}
\begin{itemize}
  \item<1-> PX4 používa kvaternióny, ale je to iba P regulátor 
  \item<2-> ArduCopter v podstate taktiež tam má P regulátor + FF
\end{itemize}

  \begin{onlyenv}<1->
  \begin{figure}
\centering
  \includegraphics[width=100mm]{PX4_Angle}\\
\end{figure}
\end{onlyenv}


  \begin{onlyenv}<2->
  \begin{figure}
\centering
  \includegraphics[width=80mm]{AP_Angle}\\
\end{figure}
\end{onlyenv}

  \end{frame}



  \begin{frame}[t]{Zmena súradníc}
\begin{itemize}
  \item<1-> aaaa
\end{itemize}

  \begin{onlyenv}<1->
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{PID_HighLevel2}\\
\end{figure}
\end{onlyenv}

  \end{frame}
  


  \begin{frame}[t]{Rýchlosť}
\begin{itemize}
  \item<1-> aaaa
\end{itemize}

  \begin{onlyenv}<1->
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{PID_HighLevel3}\\
\end{figure}
\end{onlyenv}


  \begin{onlyenv}<2->
  \begin{figure}
\centering
  \includegraphics[width=70mm]{PX4_Velocity}\\
\end{figure}
\end{onlyenv}

  \end{frame}


 \begin{frame}[t]{Poloha}
\begin{itemize}
  \item<1-> aaaa
\end{itemize}

  \begin{onlyenv}<1->
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{PID_HighLevel4}\\
\end{figure}
\end{onlyenv}


  \begin{onlyenv}<2->
  \begin{figure}
\centering
  \includegraphics[width=50mm]{PX4_Position}\\
\end{figure}
\end{onlyenv}
  \end{frame}
  



\begin{frame}[t]{Tvarovanie žiadaných hodnôt}
  \begin{itemize}
  \item<1-> Dron je stabilizovaný, pilot/ROS náhle chce $r_{\Phi}=$+30$^\circ$ klonenie. Čo sa stane s riadením?
  \item<2->  Žiadaná hodnota je skokový signál. Derivácia skoku je... D zložka a tým aj vstup do akčných členov vystrelí!
  \item<3->  Potrebujeme tvarovať vstupy do regulácie \angl{input shaping}, t.j. tvarovať žiadané hodnoty:
        \begin{itemize}
  \item Pomalšie vzorkovanie na rýchlejšie (interpolácia) \footnote{ArduCopter 50 Hz $\rightarrow$ 400 Hz \citep{AP:PID}}
  \item Vyhladenie filtráciou, saturácie
  \item<4-> Ak hovoríme o manuálnom pilotovaní, tvarovanie určuje aký ``pocit'' je riadiť stroj
  \end{itemize}
  \end{itemize}

        \begin{onlyenv}<2>
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{InputShaping_1}\\
\end{figure}
\end{onlyenv}


        \begin{onlyenv}<3->
  \begin{figure}
\centering
  \includegraphics[width=\textwidth]{InputShaping_2}\\
\end{figure}
\end{onlyenv}







\end{frame}

\begin{frame}[t]{Inicializácia riadenia}
\begin{itemize}
  \item<1-> Ako naštartujeme riadenie? Aká je odchýlka $e(0)$ pri štarte?
  \item<2-> Kritické pri zmene letových módov.
  \item<3-> Pre ArduCopter \cite{AP:PID}
    \begin{itemize}
    \item Nadradené riadenie poloha vs. rýchlosť (P) --- tak aby vstup bol konštantný
    \item Rýchlosť (PID) --- $e(0)=0$, I zložka s konštantným vstupom, zrátať D pri nastavení žiadanej hodnoty
\end{itemize}
\end{itemize}
\end{frame}






\begin{frame}{Je perfektné sledovanie trasy možné?}
\begin{itemize}
\item<1-> Majme trasu WP1 do WP2, všetko je v poriadku.
\item<2-> Pridajme WP3 a rozmýšľajme čo sa deje pri WP2. Je možné preletieť nad WP2?
\item<3-> Buď musíme úplne sa zastaviť alebo nemôžeme priamo preletieť --- ináč by sme potrebovali nekonečne veľké zrýchlenia
\end{itemize}

\begin{onlyenv}<1>
  \begin{figure}
\centering
  \includegraphics[width=60mm]{PositionControl}\\
\end{figure}
\end{onlyenv}

\begin{onlyenv}<2>
  \begin{figure}
\centering
  \includegraphics[width=60mm]{PositionControl2}\\
\end{figure}
\end{onlyenv}

\begin{onlyenv}<3>
  \begin{figure}
\centering
  \includegraphics[width=60mm]{PositionControl3}\\
\end{figure}
\end{onlyenv}


\end{frame}


\begin{frame}[t]{Automatické nastavenie parametrov}
\begin{itemize}
  \item ArduPilot (ArduCopter) --- Napodobňuje heuristiku \citep{AP:LogSeminar}
  \begin{itemize}
  \item Zvyšuje D parameter pomaly
  \item Akonáhle deteguje osciláciu, zníži D parameter
  \item Opakuje pre iné zložky/slučky
\end{itemize}
\item Intuitívne ale konzervatívne
\end{itemize}

\end{frame}



\begin{frame}
Notes: \cite{AP:PID}

User (ROS) $\rightarrow$ Shaping $\rightarrow$ PID $\rightarrow$ Actuators
Yaw je prioritizovanych nad Pitch Roll, lebo to drzi dron v lufte \citep{Erasmus2020}
50 Hz -> 400 Hz
Min 24 tazsie uchopytelne koncepty pre prezentaciu, dava menej konkretnosti
Velocity prioritizuje vertikalnu rychlost   \citep{Erasmus2020}
\end{frame}



\thankyouslide{gergely.takacs@stuba.sk}{SK}
\referencesslidebiber{SK}

%\backupbegin
%\input{...
%\backupend


\end{document}
